@{
    ViewData["Title"] = "Home";
}

<section class="container pt-5 bg-white">
    <div class="container mb-5">
        <div class="flex-row d-flex">
            <div class="flex-column me-4">
                <h3 style="color: #193d69;" class="m-0">Forex Daily Prices</h3>
                <p class="small m-0">Last refresh: 2024-02-01 11:20</p>
            </div>
            <div class="flex-row d-flex">
                <select onchange="GetForexDailyPrices()" class="form-select mx-2 rounded-0" id="from_symbol" aria-label="Currency From">
                    <option selected value="EUR">EUR</option>
                    <option value="GBP">GBP</option>
                    <option value="USD">USD</option>
                </select>
                <select class="form-select mx-2 rounded-0" id="to_symbol" aria-label="Currency To">
                    <option value="EUR">EUR</option>
                    <option selected value="GBP">GBP</option>
                    <option value="USD">USD</option>
                </select>
            </div>
            <button class="d-flex align-items-center border-0 bg-white" onclick="GetForexDailyPrices()">
                <i class="bi bi-arrow-clockwise" style="font-size: 1.5rem; color: #626262"></i>
            </button>
        </div>
    </div>
    <table class="table table-bordered table-specs text-center " id="dailyPricesTable">
        <thead>
            <tr style="color: #646464">
                <th scope="col">Date</th>
                <th scope="col">Open</th>
                <th scope="col">High</th>
                <th scope="col">Low</th>
                <th scope="col">Close</th>
            </tr>
        </thead>
        <tbody>
            
        </tbody>
    </table>
</section>

<script src="~/lib/jquery/dist/jquery.js"></script>
<script lang="en" type="text/javascript">
    function GetForexDailyPrices() {
        var from_symbol = document.querySelector('#from_symbol').value;
        var to_symbol = document.querySelector('#to_symbol').value;
        var getDailyPricesParams = {
            "from_symbol": from_symbol,
            "to_symbol": to_symbol
        };
        console.log(getDailyPricesParams);
        $.ajax({
            type: "GET",
            data: getDailyPricesParams,
            url: "Forex/GetDailyPrices",
            success: function (response) {
                console.log(response);
                // Validate response data
                if (response && response["Time Series FX (Daily)"]) {
                    var tableBody = $('#dailyPricesTable tbody');
                    // Clear any existing rows
                    tableBody.empty();

                    $.each(response["Time Series FX (Daily)"], function (date, price) {
                        var row = $('<tr>')
                        row.append($('<td>').text(date));
                        row.append($('<td>').text(price["1. open"]));
                        row.append($('<td>').text(price["2. high"]));
                        row.append($('<td>').text(price["3. low"]));
                        row.append($('<td>').text(price["4. close"]));
                        tableBody.append(row);
                    });
                } else {
                    console.error("No data found.");
                }
            },
            error: function (xhr, status, error) {
                console.log("Error occurred:", error);
            }
        });
    }
</script>